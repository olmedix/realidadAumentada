<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AR simple con A-Frame</title>

  <!-- A-Frame -->
  <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
  <!-- Componente de Hit-Test (detectar plano y colocar objeto con un toque) -->
  <script src="https://cdn.jsdelivr.net/npm/aframe-ar-hit-test-component@1.3.0/dist/aframe-ar-hit-test-component.min.js"></script>

  <style>
    html,body{margin:0;height:100%}
    #start,#recolocar{
      position:fixed;left:50%;transform:translateX(-50%);
      z-index:20;padding:12px 16px;font:600 16px system-ui;border:0;border-radius:12px;
      background:#0ea5e9;color:#fff;box-shadow:0 10px 28px rgba(0,0,0,.25);cursor:pointer
    }
    #start{top:50%}
    #recolocar{bottom:16px;display:none}
    #hint{
      position:fixed;left:0;right:0;top:0;padding:.6rem 1rem;z-index:10;
      color:#fff;background:linear-gradient(180deg,rgba(0,0,0,.55),transparent);
      font:600 14px/1.2 system-ui;pointer-events:none
    }
    /* Fondo transparente por si la cámara tarda en aparecer */
    a-scene{background:transparent !important}
  </style>
</head>
<body>
  <div id="hint">Mueve el móvil hasta ver el retículo y <b>toca</b> la mesa para colocar el cubo.</div>
  <button id="start">Iniciar AR</button>
  <button id="recolocar">Recolocar</button>

  <a-scene
    embedded
    renderer="antialias:true; colorManagement:true; physicallyCorrectLights:true; alpha:true"
    webxr="mode: ar; optionalFeatures: hit-test"
    vr-mode-ui="enabled: false"
    xr-mode-ui="enabled: false">

    <!-- Luces sencillas -->
    <a-entity light="type:ambient; intensity:0.7"></a-entity>
    <a-entity light="type:directional; intensity:0.9" position="0 2 1"></a-entity>

    <!-- Tu objeto: un cubo de 20 cm. Empieza oculto hasta que lo coloques -->
    <a-box id="cubo" visible="false"
           depth="0.2" height="0.2" width="0.2"
           material="color:#FF6A00; metalness:0.2; roughness:0.6">
    </a-box>

    <!-- El componente hace el retículo y, al tocar, coloca #cubo y lo deja anclado -->
    <a-entity ar-hit-test="target: #cubo"></a-entity>

    <a-entity camera></a-entity>
  </a-scene>

  <script>
    const scene = document.querySelector('a-scene');
    const startBtn = document.getElementById('start');
    const recolocarBtn = document.getElementById('recolocar');
    const cubo = document.getElementById('cubo');

    // 1) Botón propio para iniciar AR (gesto del usuario)
    startBtn.addEventListener('click', async () => {
      try{
        await scene.enterVR(); // con webxr mode: ar, esto abre AR (no VR)
        startBtn.style.display = 'none';
      }catch(e){
        alert('No se pudo iniciar AR: ' + (e?.message || e));
      }
    });

    // 2) Mostrar botón "Recolocar" cuando el cubo ya está puesto
    cubo.addEventListener('componentchanged', (e) => {
      if (e.detail.name === 'visible' && cubo.getAttribute('visible')) {
        recolocarBtn.style.display = 'inline-block';
      }
    });

    // 3) Recolocar: ocultamos el cubo para que el próximo toque lo vuelva a colocar
    recolocarBtn.addEventListener('click', () => {
      cubo.setAttribute('visible', false);
      recolocarBtn.style.display = 'none';
    });

    // Si sales de AR, vuelve a mostrar el botón iniciar
    scene.addEventListener('exit-vr', () => {
      startBtn.style.display = 'inline-block';
      recolocarBtn.style.display = 'none';
      cubo.setAttribute('visible', false);
    });
  </script>
</body>
</html>
