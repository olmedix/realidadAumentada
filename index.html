<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AR fijo: cubo en posici√≥n absoluta</title>

  <!-- A-Frame -->
  <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>

  <style>
    html,body{margin:0;height:100%}
    #start{
      position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);
      z-index:20;padding:12px 16px;font:600 16px system-ui;border:0;border-radius:12px;
      background:#0ea5e9;color:#fff;box-shadow:0 10px 28px rgba(0,0,0,.25);cursor:pointer
    }
    a-scene{background:transparent !important}
  </style>
</head>
<body>
  <button id="start">Iniciar AR</button>

  <a-scene id="scene"
    embedded
    renderer="antialias:true; colorManagement:true; physicallyCorrectLights:true; alpha:true"
    webxr="mode: ar"
    vr-mode-ui="enabled:false"
    xr-mode-ui="enabled:false"
    loading-screen="enabled:false">

    <!-- Luces sencillas -->
    <a-entity light="type:ambient; intensity:0.9"></a-entity>
    <a-entity light="type:directional; intensity:1.0" position="0 2 1"></a-entity>

    <!-- üëá CUBO FIJO: 0.75 m de alto, 1 m delante del origen inicial -->
    <a-box id="cubo"
           position="0 0.75 -1"
           depth="0.2" height="0.2" width="0.2"
           material="color:#FF6A00; metalness:0.2; roughness:0.6">
    </a-box>

    <a-entity camera></a-entity>
  </a-scene>

  <script>
    const scene = document.getElementById('scene');
    const start = document.getElementById('start');

    // Pedimos la sesi√≥n AR directamente para evitar que entre en VR
    async function startAR(){
      if (!('xr' in navigator)) { alert('navigator.xr no disponible'); return; }
      const ok = await navigator.xr.isSessionSupported('immersive-ar');
      if (!ok) { alert('Este navegador no soporta immersive-ar'); return; }

      const session = await navigator.xr.requestSession('immersive-ar', {
        optionalFeatures: ['local-floor'] // referencia con altura del suelo si est√° disponible
      });

      const gl = scene.renderer.getContext();
      if (gl.makeXRCompatible) await gl.makeXRCompatible();
      scene.renderer.xr.setSession(session);

      start.style.display = 'none';
      session.addEventListener('end', () => { start.style.display = 'inline-block'; });
    }

    start.addEventListener('click', () => {
      startAR().catch(e => alert('No se pudo iniciar AR: ' + (e?.message || e)));
    });
  </script>
</body>
</html>
